<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book Library Manager</title>
  <link rel="stylesheet" href="/books.css">
</head>
<body>
  <div class="page">
    <header class="header">
      <div>
        <h1>Book Library Manager</h1>
        <p>Secure CRUD with owner access, roles, and related reviews</p>
      </div>
      <nav class="nav">
        <a href="/home">Landing</a>
        <a href="/about">About</a>
        <a href="/contact">Contact</a>
      </nav>
    </header>

    <main class="main">
      <div id="alertBox" class="alert"></div>

      <section class="panel">
        <div class="panel-header">
          <h2>Authentication</h2>
          <span id="authBadge" class="badge badge-off">Not authenticated</span>
        </div>

        <div id="loginSection">
          <form id="loginForm" class="inline-form">
            <input type="text" id="loginUsername" placeholder="Username" required>
            <input type="password" id="loginPassword" placeholder="Password" required>
            <button type="submit" class="btn btn-primary">Login</button>
          </form>
          <form id="registerForm" class="inline-form">
            <input type="text" id="registerUsername" placeholder="New username" required>
            <input type="password" id="registerPassword" placeholder="New password (min 8)" required>
            <button type="submit" class="btn btn-secondary">Register</button>
          </form>
          <p class="hint">Role <strong>user</strong> can modify only own books/reviews. <strong>admin</strong> can manage all.</p>
        </div>

        <div id="sessionSection" class="hidden">
          <p class="hint">Logged in as <strong id="currentUser">-</strong></p>
          <button id="logoutBtn" class="btn btn-secondary" type="button">Logout</button>
        </div>
      </section>

      <section class="stats">
        <div class="stat-card">
          <div id="totalBooks" class="stat-value">0</div>
          <div class="stat-label">Total Books</div>
        </div>
        <div class="stat-card">
          <div id="avgRating" class="stat-value">0.0</div>
          <div class="stat-label">Avg Rating (Page)</div>
        </div>
        <div class="stat-card">
          <div id="pageBooksCount" class="stat-value">0</div>
          <div class="stat-label">Books On Page</div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Filters & Pagination</h2>
        </div>
        <form id="filtersForm" class="grid-4">
          <input id="filterTitle" type="text" placeholder="Title">
          <input id="filterAuthor" type="text" placeholder="Author">
          <input id="filterGenre" type="text" placeholder="Genre">
          <select id="pageSize">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="20">20</option>
          </select>
        </form>
        <div class="toolbar">
          <label><input type="checkbox" id="mineOnly"> Show only my books</label>
          <div class="actions">
            <button id="applyFiltersBtn" type="button" class="btn btn-primary btn-small">Apply</button>
            <button id="clearFiltersBtn" type="button" class="btn btn-secondary btn-small">Clear</button>
          </div>
        </div>
      </section>

      <section class="panel" id="writePanel">
        <div class="panel-header">
          <h2>Add New Book</h2>
          <span id="writeLockLabel" class="lock-label">Read-only mode</span>
        </div>
        <div class="grid-4">
          <input id="title" type="text" placeholder="Title *" maxlength="200">
          <input id="author" type="text" placeholder="Author *" maxlength="200">
          <input id="genre" type="text" placeholder="Genre" maxlength="100">
          <input id="isbn" type="text" placeholder="ISBN" maxlength="40">
          <input id="pages" type="number" placeholder="Pages" min="1" max="10000">
          <input id="published_year" type="number" placeholder="Published year" min="1000" max="2099">
          <input id="rating" type="number" placeholder="Rating 0-10" min="0" max="10" step="0.1">
          <textarea id="description" placeholder="Description" maxlength="1500"></textarea>
        </div>
        <div class="actions">
          <button id="addBookBtn" type="button" class="btn btn-primary">Add Book</button>
          <button id="clearFormBtn" type="button" class="btn btn-secondary">Clear</button>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>Library Catalog</h2>
          <button id="refreshBtn" type="button" class="btn btn-secondary btn-small">Refresh</button>
        </div>
        <div class="toolbar">
          <div id="bookPageInfo" class="hint">Page 1 / 1</div>
          <div class="actions">
            <button id="prevPageBtn" type="button" class="btn btn-secondary btn-small">Previous</button>
            <button id="nextPageBtn" type="button" class="btn btn-secondary btn-small">Next</button>
          </div>
        </div>
        <div id="booksLoading" class="hint hidden">Loading books...</div>
        <div id="booksContainer" class="table-wrap"></div>
      </section>

      <section id="adminPanel" class="panel hidden">
        <div class="panel-header">
          <h2>Admin Users</h2>
          <span class="pill">Admin only</span>
        </div>
        <div class="toolbar">
          <div id="usersPageInfo" class="hint">Users page 1 / 1</div>
          <div class="actions">
            <button id="prevUsersBtn" type="button" class="btn btn-secondary btn-small">Previous</button>
            <button id="nextUsersBtn" type="button" class="btn btn-secondary btn-small">Next</button>
            <button id="refreshUsersBtn" type="button" class="btn btn-secondary btn-small">Refresh</button>
          </div>
        </div>
        <div id="usersLoading" class="hint hidden">Loading users...</div>
        <div id="usersContainer" class="table-wrap"></div>
      </section>
    </main>
  </div>

  <div id="editModal" class="modal hidden">
    <div class="modal-card">
      <div class="panel-header">
        <h2>Edit Book</h2>
        <button id="closeEditBtn" type="button" class="btn btn-secondary btn-small">Close</button>
      </div>
      <div class="grid-4">
        <input id="editTitle" type="text" placeholder="Title *" maxlength="200">
        <input id="editAuthor" type="text" placeholder="Author *" maxlength="200">
        <input id="editGenre" type="text" placeholder="Genre" maxlength="100">
        <input id="editIsbn" type="text" placeholder="ISBN" maxlength="40">
        <input id="editPages" type="number" placeholder="Pages" min="1" max="10000">
        <input id="editPublishedYear" type="number" placeholder="Published year" min="1000" max="2099">
        <input id="editRating" type="number" placeholder="Rating 0-10" min="0" max="10" step="0.1">
        <textarea id="editDescription" placeholder="Description" maxlength="1500"></textarea>
      </div>
      <div class="actions">
        <button id="saveEditBtn" type="button" class="btn btn-primary">Save</button>
        <button id="cancelEditBtn" type="button" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <div id="reviewsModal" class="modal hidden">
    <div class="modal-card">
      <div class="panel-header">
        <h2 id="reviewsTitle">Reviews</h2>
        <button id="closeReviewsBtn" type="button" class="btn btn-secondary btn-small">Close</button>
      </div>
      <div class="toolbar">
        <div id="reviewsPageInfo" class="hint">Page 1 / 1</div>
        <div class="actions">
          <button id="prevReviewsBtn" type="button" class="btn btn-secondary btn-small">Previous</button>
          <button id="nextReviewsBtn" type="button" class="btn btn-secondary btn-small">Next</button>
          <button id="refreshReviewsBtn" type="button" class="btn btn-secondary btn-small">Refresh</button>
        </div>
      </div>
      <div id="reviewsLoading" class="hint hidden">Loading reviews...</div>
      <div id="reviewsContainer"></div>

      <section class="panel">
        <div class="panel-header">
          <h2 id="reviewFormTitle">Add Review</h2>
          <span id="reviewWriteLabel" class="lock-label">Login required</span>
        </div>
        <div class="grid-2">
          <input id="reviewRating" type="number" placeholder="Rating 1-5" min="1" max="5" step="0.1">
          <textarea id="reviewComment" placeholder="Comment" maxlength="1000"></textarea>
        </div>
        <div class="actions">
          <button id="saveReviewBtn" type="button" class="btn btn-primary">Save Review</button>
          <button id="cancelReviewEditBtn" type="button" class="btn btn-secondary">Cancel Edit</button>
        </div>
      </section>
    </div>
  </div>

  <script src="/books.js"></script>
</body>
</html>
